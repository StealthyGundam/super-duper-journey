<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Character Creation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>

<style>
body {
  font-family: 'Compacta', sans-serif;
  font-size: 16px;
  background: #111;
  color: #eee;
  text-align: center;
}

h1 {
  margin-top: 20px;
  text-align: center;
  font-family: 'Franklin Gothic Condensed', sans-serif;

  font-size: clamp(30px, 8vw, 70px);

  color: 000;
  white-space: nowrap;

  text-shadow:
    0 0 10px #00ffff,
    0 0 20px #006cff,
    0 0 30px #8d00ff,
    0 0 40px #ff00f5;
}

h2 {
font-family: 'Franklin Gothic Condensed', sans-serif;
  text-align: center;
  margin: 0;
  color: 000;
font-size: 30px;
text-shadow:0 0 2px #00ffff,
           0 0 4px #006cffff,
           0 0 6px #576dc9ff,
           0 0 8px #ff00f5ff;}
#rollDiceBtn {
  display: block;      /* allows margin auto to work */
  margin: 20px auto;   /* centers the button horizontally */
  font-size: 16px;
  cursor: pointer;
}


section {
margin:30px auto;
padding:10px;
border-radius:20px;
width: 100%;
max-width:800px;
background:#222;
box-shadow:
           0 0 2px #fff,
           0 0 6px #00ffff,
           0 0 9px #006cffff,
           0 0 12px #576dc9ff,
           0 0 16px #ff00f5ff,
     inset -0 -0 2px #fff,
     inset -0 -0 6px #00ffff,
     inset -0 -0 9px #006cffff,
     inset -0 -0 12px #576dc9ff,
     inset -0 -0 16px #ff00f5ff;

         
text-align:left; }

button { margin:5px auto; padding:5px 15px; font-size:1 rem; cursor:pointer; background:#333; color:#eee; border:none; border-radius:5px; }
button:hover { background:#555; }
input, select { font-size:0.2 rem; padding:5px; margin-top:5px; border-radius:5px; border:1px solid #555; background:#111; color:#eee; width:100%; box-sizing:border-box; }
input[disabled], select[disabled] { background:#222; color:#888; }

* {box-sizing: border-box;}

.dice-container { display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-top:10px; }
.dice-wrapper { position:relative; width:150px; height:150px; cursor:pointer; border-radius:10px; border:2px solid transparent; }
.dice-number-overlay { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:60px; font-weight:bold; color:#fff; pointer-events:none;-webkit-text-stroke: 1px black;text-shadow: 1px 1px 0 #000, -1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000;}


/*===============================================================================*/
Section 1 CHARACTER {
  margin: 20px auto;
  padding: 20px;
  border-radius: 10px;
  width: 500px;
  background: #222;
  box-shadow: 0 0 10px #000;
  text-align: left;
}

input, select {
  font-size: 0.8rem;
  padding: 6px;
  margin-top: 5px;
  border-radius: 5px;
  border: 1px solid #555;
  background: #111;
  color: #eee;
  width: 100%;
  box-sizing: border-box;
}
/*===============================================================================*/
/* Cloudflare-style fake captcha */
.cf-captcha {
  margin-top: 5px;
  background: linear-gradient(#2a2a2a, #1e1e1e);
  border: 1px solid #f68626ff;
  border-radius: 4px;
  padding: 14px;
}

.cf-box {
  display: flex;
  align-items: center;
  gap: 14px;
  cursor: pointer;
  user-select: none;
}

.cf-box input {
  display: none;
}

.cf-check {
  width: 22px;
  height: 22px;
  border: 2px solid #aaa;
  background: #111;
  border-radius: 3px;
  position: relative;
}

.cf-box input:checked + .cf-check::after {
  content: "";
  position: absolute;
  left: 5px;
  top: 1px;
  width: 6px;
  height: 12px;
  border: solid #fff;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.cf-text {
  flex-grow: 1;
  font-size: 15px;
  color: #eee;
}

.cf-brand {
  text-align: right;
  font-size: 11px;
  color: #bbb;
}

.cf-brand img {
  height: 18px;
  display: block;
  margin-left: auto;
  margin-bottom: 2px;
  filter: brightness(0.9);
}

.cf-links a {
  color: #bbb;
  text-decoration: none;
}

.cf-links a:hover {
  text-decoration: underline;
}
/*===============================================================================*/
/* Section 2: Perks */
#perksContainer table {width: 100%;border-collapse: collapse;}
#perksContainer tr {border-bottom: 1px solid #444;}
#perksContainer td {padding: 0px 4px;vertical-align: left;}
#perksContainer td.checkbox-cell {width: 20;text-align: left;}
#perksContainer input[type="checkbox"] {transform: scale(1.3);cursor: pointer;}
#perksContainer .perk-name {font-weight: bold;font-size: 20px;color: #5280f8ff}
#perksContainer .perk-desc {font-size: 12px;color: #af7ff7ff;margin-top: 1px;}
#perksContainer .perk-efec {font-size: 10px;color: #c935cdff;margin-top: 1px;}

/*===============================================================================*/


</style>
</head>
<body>
<!======== 1. Character Info  ========>
<section>
  <h2>Character Information</h2>
  <input type="text" id="charName" placeholder="-- Choose Your Character's Name --" />
  <select id="raceSelect">
    <option value="">-- Choose a Race --</option>
    <option value="Dragonborn">Dragonborn</option>
    <option value="Drow">Drow</option>
    <option value="Dwarf">Dwarf</option>
    <option value="Elf">Elf</option>
    <option value="Gnome">Gnome</option>
    <option value="Halfling">Halfling</option>
    <option value="Human">Human</option>
    <option value="Orc">Orc</option>
    <option value="Tiefling">Tiefling</option>
  </select>
<!-- Cloudflare-style captcha checkbox -->
<div id="humanCaptcha" class="cf-captcha" style="display:none;">
  <label class="cf-box">
    <input type="checkbox" id="humanCaptchaCheck" />
    <span class="cf-check"></span>
    <span class="cf-text">Verify you are a human</span>
    <span class="cf-brand">
      <img src="https://upload.wikimedia.org/wikipedia/commons/4/4b/Cloudflare_Logo.svg" alt="Cloudflare">
      <span class="cf-links">
        <a href="#">Privacy</a> Â· <a href="#">Terms</a>
      </span>
    </span>
  </label>
</div>
  <select id="classSelect">
    <option value="">-- Choose a Class --</option>
    <option>Barbarian</option>
    <option>Bard</option>
    <option>Cleric</option>
    <option>Druid</option>
    <option>Fighter</option>
    <option>Monk</option>
    <option>Paladin</option>
    <option>Rogue</option>
    <option>Wizard</option>
  </select>
</section>

<script>
const raceSelect = document.getElementById("raceSelect");
const captchaBox = document.getElementById("humanCaptcha");
const captchaCheck = document.getElementById("humanCaptchaCheck");

raceSelect.addEventListener("change", () => {
  if (raceSelect.value && raceSelect.value !== "Human") {
    captchaBox.style.display = "block";
    captchaCheck.checked = false;
    captchaCheck.disabled = false;
  } else {
    captchaBox.style.display = "none";
  }
});

captchaCheck.addEventListener("change", () => {
  if (captchaCheck.checked) {
    raceSelect.value = "Human"; // matches option value exactly
    captchaCheck.disabled = true;
    captchaBox.style.display = "none";
  }
});
</script>
<!======== 2. Choose a Background ========>
<section>
  <h2>Choose a Background</h2>
  <div id="perksContainer"></div>

  
</section>
<!======== 3. Roll dice for additional skill points ========>
<section>

  <h2>Roll for additional skill points</h2>
<button id="rollDiceBtn">Roll 2 D20s and discard one</button>
  <div class="dice-container" id="diceContainer">
    <div class="dice-wrapper">
      <div id="dice3dContainer1"></div>
      <span id="diceNumber1" class="dice-number-overlay"></span>
    </div>
    <div class="dice-wrapper">
      <div id="dice3dContainer2"></div>
      <span id="diceNumber2" class="dice-number-overlay"></span>
    </div>
  </div>

</section>
<script>
// --- Ensure skillPoints exists ---
if (typeof skillPoints === "undefined") skillPoints = 0;

// --- Dice Setup ---
function createDice(containerId) {
  const container = document.getElementById(containerId);
  container.style.width = "150px";
  container.style.height = "150px";

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(
    45,
    container.clientWidth / container.clientHeight,
    0.1,
    1000
  );
  const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(container.clientWidth, container.clientHeight);
  container.appendChild(renderer.domElement);

  const geometry = new THREE.IcosahedronGeometry(1, 0);
  const material = new THREE.MeshNormalMaterial({ flatShading: true });
  const dice = new THREE.Mesh(geometry, material);
  scene.add(dice);

  camera.position.z = 3;

  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5, 5, 5);
  scene.add(light);

  function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
  }
  animate();
  return dice;
}

// Create dice
const dice3d_1 = createDice("dice3dContainer1");
const dice3d_2 = createDice("dice3dContainer2");

const diceNumbers = [
  document.getElementById("diceNumber1"),
  document.getElementById("diceNumber2")
];
const diceWrappers = [
  document.querySelector("#dice3dContainer1").parentElement,
  document.querySelector("#dice3dContainer2").parentElement
];

// Load saved state
let diceRolls = JSON.parse(localStorage.getItem("diceRolls")) || [];
let discarded = JSON.parse(localStorage.getItem("discardedDice")) ?? null;
let keptValue = JSON.parse(localStorage.getItem("keptDiceValue")) ?? 0;
let canDiscard = false;

// Roll button
const rollBtn = document.getElementById("rollDiceBtn");

// Update skill display function (placeholder)
function updateSkillDisplay() {
  const spEl = document.getElementById("skillPoints");
  if (spEl) spEl.textContent = skillPoints;
}

// --- Restore dice if already rolled ---
function restoreDiceState() {
  if (diceRolls.length === 2) {
    diceNumbers.forEach((d, i) => {
      d.style.display = "block";
      d.textContent = diceRolls[i];
    });
    canDiscard = true;

    if (discarded !== null) {
      diceWrappers[discarded].style.border = "2px solid red";
      diceWrappers[1 - discarded].style.border = "2px solid green";
      diceWrappers.forEach(w => w.style.pointerEvents = "none");

      // Apply kept value
      skillPoints += keptValue;
      updateSkillDisplay();
    }
  }
}

restoreDiceState();

// --- Roll Dice ---
rollBtn.addEventListener("click", () => {
  if (diceRolls.length === 2) return; // already rolled

  // Generate two random D20 rolls
  diceRolls = [Math.floor(Math.random() * 20) + 1, Math.floor(Math.random() * 20) + 1];
  localStorage.setItem("diceRolls", JSON.stringify(diceRolls));

  // Spin animation
  let frames = 0;
  const totalFrames = 120;
  const spins = [Math.random() * 4 + 4, Math.random() * 4 + 4];

  function spinDice() {
    dice3d_1.rotation.x += spins[0] / totalFrames;
    dice3d_1.rotation.y += spins[0] / totalFrames;
    dice3d_2.rotation.x += spins[1] / totalFrames;
    dice3d_2.rotation.y += spins[1] / totalFrames;
    frames++;
    if (frames < totalFrames) requestAnimationFrame(spinDice);
    else {
      diceNumbers.forEach((d, i) => {
        d.style.display = "block";
        d.textContent = diceRolls[i];
      });
      canDiscard = true;
    }
  }

  spinDice();
});

// --- Discard dice selection ---
diceWrappers.forEach((wrapper, idx) => {
  wrapper.addEventListener("click", () => {
    if (!canDiscard || discarded !== null) return;

    discarded = idx;
    keptValue = diceRolls[1 - idx];

    // Save everything
    localStorage.setItem("diceRolls", JSON.stringify(diceRolls));
    localStorage.setItem("discardedDice", JSON.stringify(discarded));
    localStorage.setItem("keptDiceValue", JSON.stringify(keptValue));

    // Visual cues
    wrapper.style.border = "2px solid red";
    diceWrappers[1 - idx].style.border = "2px solid green";
    diceWrappers.forEach(w => w.style.pointerEvents = "none");

    // Add kept value to skill points
    skillPoints += keptValue;
    updateSkillDisplay();
  });
});
</script>

<!======== Section 4: Skills ========>
<section>
  <h2>Allocate Skill Points</h2>
  <p>You have <span id="skillPoints">0</span> points to spend</p>
<div id="skillsContainer"></div>




<script>
// --- Skill setup ---
const skillData = [
  { name:"Awareness", desc:"Notice objects hiding in plain sight, even if obvious" },
  { name:"Charisma", desc:"Convince inanimate objects and pets to do what you want" },
  { name:"Intelligence", desc:"Solve complex problems and unlock clever tricks" },
  { name:"Luck", desc:"Strange coincidences tend to favor you unexpectedly" },
  { name:"Navigation", desc:"Find your way with more accurate maps and markers" },
  { name:"Patience", desc:"Reduces cooldowns and delays between repeated actions" },
  { name:"Procrastination", desc:"Delay actions long enough to create new opportunities" },
  { name:"Wisdom", desc:"Recall sequences and past events with greater ease" }
];

// --- Load or initialize skill values ---
let skillValues = {};
skillData.forEach(s => skillValues[s.name] = 3); // reset all to base 3

// --- Restore skill points from dice roll ---
let diceKeptValue = JSON.parse(localStorage.getItem("keptDiceValue")) || 0;
let skillPoints = diceKeptValue;

// --- Update skill display ---
function updateSkillDisplay() {
  document.getElementById("skillPoints").textContent = skillPoints;
  skillData.forEach(s => {
    const valEl = document.getElementById(s.name + "Val");
    if (valEl) valEl.textContent = skillValues[s.name] < 10 ? "0" + skillValues[s.name] : skillValues[s.name];
  });
}

// --- Save skills to localStorage ---
function saveSkills() {
  localStorage.setItem("skillValues", JSON.stringify(skillValues));
  localStorage.setItem("skillPoints", JSON.stringify(skillPoints));
}

// --- Render skills table ---
function renderSkills() {
  const container = document.getElementById("skillsContainer");
  container.innerHTML = "";

  const table = document.createElement("table");
  table.style.width = "100%";
  table.style.borderCollapse = "collapse";

  skillData.forEach(s => {
    const tr = document.createElement("tr");
    tr.style.borderBottom = "1px solid #444";
    tr.style.verticalAlign = "middle";

    // "-" button
    const tdDec = document.createElement("td");
    tdDec.style.textAlign = "left";
    const decBtn = document.createElement("button");
    decBtn.textContent = "-";
    decBtn.style.padding = "6px 10px";
    decBtn.addEventListener("click", () => {
      if (skillValues[s.name] > 1) {
        skillValues[s.name]--;
        skillPoints++;
        updateSkillDisplay();
        saveSkills();
      }
    });
    tdDec.appendChild(decBtn);
    tr.appendChild(tdDec);

    // Value display
    const tdVal = document.createElement("td");
    tdVal.style.textAlign = "left";
    const valSpan = document.createElement("span");
    valSpan.id = s.name + "Val";
    valSpan.style.fontWeight = "bold";
    valSpan.style.fontSize = "20px";
    valSpan.textContent = skillValues[s.name];
    tdVal.appendChild(valSpan);
    tr.appendChild(tdVal);

    // "+" button
    const tdInc = document.createElement("td");
    tdInc.style.textAlign = "left";
    const incBtn = document.createElement("button");
    incBtn.textContent = "+";
    incBtn.style.padding = "6px 10px";
    incBtn.addEventListener("click", () => {
      if (skillPoints > 0 && skillValues[s.name] < 10) {
        skillValues[s.name]++;
        skillPoints--;
        updateSkillDisplay();
        saveSkills();
      }
    });
    tdInc.appendChild(incBtn);
    tr.appendChild(tdInc);

    // Skill info
    const tdInfo = document.createElement("td");
    const nameDiv = document.createElement("div");
    nameDiv.textContent = s.name;
    nameDiv.style.fontWeight = "bold";
    nameDiv.style.fontSize = "20px";
    const descDiv = document.createElement("div");
    descDiv.textContent = s.desc;
    descDiv.style.fontSize = "10px";
    descDiv.style.color = "#aaa";
    descDiv.style.marginTop = "2px";
    tdInfo.appendChild(nameDiv);
    tdInfo.appendChild(descDiv);
    tr.appendChild(tdInfo);

    table.appendChild(tr);
  });

  container.appendChild(table);
}

// --- Perks setup ---
const perkData = [
  {name:"ðŸ’Š Adderall Prescription â˜•ï¸", desc:"Mixing adderall and caffeine is generally not recommended", efec:"+2 Awareness, +2 Intelligence, -2 Navigation, -2 Procrastination"},
  {name:"ðŸ§‘â€âœˆï¸ Front Seat Navigator Companion ðŸš—", desc:"Certified expert in driving from the comfort of doing nothing", efec:"+1 Charisma, +3 Navigation, -2 Patience, -2 Awareness"},
  {name:"ðŸ’¡Leftover Logic", desc:"Things that donâ€™t make sense suddenly make partial sense", efec:"+2 Procrastination, +2 Wisdom, -2 Awareness, -2 Luck, -2 Patience"},
  {name:"ðŸŽ­ Reverse Psychology ðŸ”„", desc:"Puzzles try to trick you less when you overthink them", efec:"+6 Procrastination, -3 Wisdom, -2 Intelligence, -2 Patience"},
{name:"ðŸ€ Sevenâ€‘Leaf Clover ðŸŽ²", desc:"Your dice have a habit of always hitting the high numbers", efec:"+7 Luck, -1 All Other Skills"}

];

const perksContainer = document.getElementById("perksContainer");
let selectedPerk = localStorage.getItem("selectedPerk") || null;
let lastAppliedPerk = null;

// Parse perk effects
perkData.forEach(p => {
  const effects = {};
  p.efec.split(",").forEach(part => {
    const match = part.trim().match(/^([+-]\d+)\s+(.+)$/);
    if (!match) return;

    const value = parseInt(match[1]);
    const target = match[2];

    if (target === "All Other Skills") {
      effects.__ALL_OTHER__ = value;
    } else {
      effects[target] = value;
    }
  });
  p.effectsObj = effects;
});


// Apply perk effects safely
function applyPerkEffects(perk) {
  const allSkills = skillData.map(s => s.name);

  // Remove last perk
  if (lastAppliedPerk) {
    Object.keys(lastAppliedPerk.effectsObj).forEach(key => {
      const val = lastAppliedPerk.effectsObj[key];

      if (key === "__ALL_OTHER__") {
        allSkills.forEach(skill => {
          if (!Object.keys(lastAppliedPerk.effectsObj).includes(skill)) {
            skillValues[skill] -= val;
          }
        });
      } else if (skillValues[key] !== undefined) {
        skillValues[key] -= val;
      }
    });
  }

  // Apply new perk
  if (perk) {
    Object.keys(perk.effectsObj).forEach(key => {
      const val = perk.effectsObj[key];

      if (key === "__ALL_OTHER__") {
        allSkills.forEach(skill => {
          if (!Object.keys(perk.effectsObj).includes(skill)) {
            skillValues[skill] += val;
          }
        });
      } else if (skillValues[key] !== undefined) {
        skillValues[key] += val;
      }
    });
    lastAppliedPerk = perk;
  } else {
    lastAppliedPerk = null;
  }

  // Clamp values 1â€“10
  allSkills.forEach(skill => {
    if (skillValues[skill] < 1) skillValues[skill] = 1;
    if (skillValues[skill] > 10) skillValues[skill] = 10;
  });

  updateSkillDisplay();
  saveSkills();
  localStorage.setItem("selectedPerk", perk ? perk.name : null);
}


// Render perks
function renderPerks() {
  const table = document.createElement("table");

  perkData.forEach(p => {
    const tr = document.createElement("tr");

    const tdCheckbox = document.createElement("td");
    tdCheckbox.classList.add("checkbox-cell");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.id = p.name;
    checkbox.checked = (selectedPerk === p.name);

    checkbox.addEventListener("change", () => {
      if(checkbox.checked){
        // Uncheck all others
        document.querySelectorAll("#perksContainer input[type='checkbox']").forEach(cb => {
          if(cb !== checkbox) cb.checked = false;
        });
        selectedPerk = p.name;
        applyPerkEffects(p);
      } else {
        selectedPerk = null;
        applyPerkEffects(null);
      }
    });

    tdCheckbox.appendChild(checkbox);
    tr.appendChild(tdCheckbox);

    const tdInfo = document.createElement("td");
    const nameDiv = document.createElement("div");
    nameDiv.classList.add("perk-name");
    nameDiv.textContent = p.name;
    const descDiv = document.createElement("div");
    descDiv.classList.add("perk-desc");
    descDiv.textContent = p.desc;
    const efecDiv = document.createElement("div");
    efecDiv.classList.add("perk-efec");
    efecDiv.textContent = p.efec;
    tdInfo.appendChild(nameDiv);
    tdInfo.appendChild(descDiv);
    tdInfo.appendChild(efecDiv);
    tr.appendChild(tdInfo);

    table.appendChild(tr);
  });

  perksContainer.innerHTML = "";
  perksContainer.appendChild(table);

  if(selectedPerk){
    const saved = perkData.find(p => p.name === selectedPerk);
    if(saved){
      const checkbox = document.getElementById(saved.name);
      if(checkbox) checkbox.checked = true;
      applyPerkEffects(saved);
    }
  }
}

// --- Initialize ---
renderSkills();
updateSkillDisplay();
renderPerks();
</script>

</section>

<!======== Section 5: Start Quest ========>
<section>
<h2>Start Quest</h2>
<button id="startQuest">Start Quest</button>
</section>


</body>
</html>
